<h1>Chat with Ollama</h1>
<% if notice %>
  <p style="color: green;"><%= notice %></p>
<% end %>

<div id="conversation">
  <% @chat_history.each do |msg| %>
    <%= render partial: "message", locals: { message: msg } %>
  <% end %>
</div>

<hr>

<%= form_with url: chat_histories_path, data: { turbo: false }, id: "chat-form" do |f| %>
  <%= f.label :message %><br>
  <%= f.text_area :message, rows: 3 %><br>

  <%= f.submit "Send", id: "submit-btn" %>
<% end %>

<hr>
<!-- Live area for streamed assistant chunk -->
<div id="streamed_reply"></div>

<%= turbo_stream_from "assistant_stream" %>
<hr>
<%= button_to "Start New Chat", reset_chat_histories_path, method: :post, class: "button" %>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("chat-form");
    const submitBtn = document.getElementById("submit-btn");

    form.addEventListener("submit", () => {
      submitBtn.disabled = true;
      submitBtn.value = "Sending...";
    });
  });
</script>
